<!doctype html>
<html version="1000">
<head>
	<meta charset="utf-8">
	<title>ezSmartAtm Builder Form 새문서</title>
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="[김윤섭][kkobiboy]">
	<link id="ui-style-core" rel="stylesheet" type="text/css" href="/core/app.controls.css">
	<script type="text/javascript" charset="utf-8" src="/HtaPlatform/Core/Form.JsApi"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.jquery.js"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.controls.js"></script>
	<style id="ui-style-user" type="text/css"></style>
	<script id="ui-script-user" type="text/javascript"></script>
</head>
<body oncontextmenu="return false;" class="ui-pre-load"><div class="ui-document ui-container" id="ui-document" lang="kr" xonload="Form_OnLoad" ide-size="1389,1120" anchor="0b0101" dock="5" ui-id="Form" ui-class="UIForm">
<div class="ui-control ui-panel ui-container" id="ui-171be2e0c07" style="left: 0px; top: 0px; width: 1280px; height: 1024px; right: auto; bottom: auto; z-index: 0; background-color: transparent;" anchor="0b0101" dock="0" ui-id="PN_form" ui-class="UIPanel"><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171be2e0c08" style="left: 0px; top: 0px; width: auto; height: 102px; right: 0px; bottom: auto; z-index: 0; background-color: rgb(23, 107, 200);" anchor="0b0101" dock="1" ui-id="PN_Title" ui-class="UIPanel" dock-r="left:98px;top:1px;width:200px;height:76px;right:auto;bottom:auto" dock-h="102" dock-w="200"><span class="ui-control ui-label" id="ui-171be2e0c09" style='left: 80px; top: 31px; width: 1120px; height: 40px; right: auto; bottom: auto; color: white; font-family: "IBK iDream M"; font-size: 38px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_title" ui-class="UILabel"><span class="ui-content">포인트조회/사용신청</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171be2e0c0a" style="left: 0px; top: 102px; width: auto; height: 92px; right: 0px; bottom: auto; z-index: 1; background-color: rgb(239, 240, 242);" anchor="0b0101" dock="1" ui-id="PN_Subtitle" ui-class="UIPanel" dock-r="left:0px;top:102px;width:1280px;height:92px;right:auto;bottom:auto" dock-h="92" dock-w="1280"><div class="ui-control ui-panel ui-container" id="ui-17355fb3e22" style="left: 80px; top: 12px; width: 1150px; height: 68px; right: auto; bottom: auto; z-index: 0; background-color: transparent;" anchor="0b0101" dock="0" ui-id="PN_Subtitle_wrap" ui-class="UIPanel"><span class="ui-control ui-label" id="ui-17355fc4297" style='left: 240px; top: 40px; width: 740px; height: 22px; right: auto; bottom: auto; font-family: "Noto sans CJK KR", "맑은 고딕", "Arial", "IBK IDream L", "IBK IDream M", "IBK IDream B", "IBK IDream EB", "IBK IDream Symbol", "IBK IWishR"; font-size: 18px; z-index: 1;' anchor="0b0101" dock="0" ui-id="LB_label4" ui-class="UILabel"><span class="ui-content">현금캐시백은 결제대금에서 자동 차감되며, 결제대금이 없을 경우 결제계좌로 입금됩니다.</span></span><span class="ui-control ui-label" id="ui-17355fc42da" style='left: 240px; top: 10px; width: 740px; height: 22px; right: auto; bottom: auto; font-family: "Noto sans CJK KR", "맑은 고딕", "Arial", "IBK IDream L", "IBK IDream M", "IBK IDream B", "IBK IDream EB", "IBK IDream Symbol", "IBK IWishR"; font-size: 18px; z-index: 2;' anchor="0b0101" dock="0" ui-id="LB_label5" ui-class="UILabel"><span class="ui-content">TOP포인트는최소 1포인트부터 1포인트 단위로 신청가능합니다.</span></span><span class="ui-control ui-label" id="ui-17355fc432e" style='left: 0px; top: 13px; width: 224px; height: 43px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 28px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_Subtitle" ui-class="UILabel"><span class="ui-content">현금 캐시백 신청 </span></span><div class="ui-control ui-panel ui-container ui-hide" id="ui-1741e6b4e8f" style="left: 217px; top: 24px; width: 2px; height: 20px; right: auto; bottom: auto; z-index: 3; background-color: rgb(191, 191, 191);" anchor="0b0101" dock="0" ui-id="PN_panel1" ui-class="UIPanel"></div></div></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-bottom" id="ui-172729dbaaf" style="left: 0px; top: auto; width: auto; height: 140px; right: 0px; bottom: 0px; z-index: 2;" anchor="0b0101" dock="2" ui-id="PN_btn" ui-class="UIPanel" dock-r="left:0px;top:884px;width:1280px;height:140px;right:auto;bottom:auto" dock-h="140" dock-w="1280"><span class="ui-control ui-button theme-orange" id="ui-172729e45a9" style='left: 36px; top: 31px; width: 258px; height: 80px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 0;' anchor="0b0101" dock="0" ui-id="BT_left" ui-class="UIButton" theme="orange" xonclick="BT_left_OnClick"><span class="ui-content">취소</span></span><span class="ui-control ui-button theme-blue" id="ui-172729ea59d" style='left: auto; top: 31px; width: 258px; height: 80px; right: 36px; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 1;' anchor="0b1001" dock="0" ui-id="BT_right" ui-class="UIButton" theme="blue" xonclick="BT_right_OnClick"><span class="ui-content">확인</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-fill" id="ui-172729f3b0f" style="left: 0px; top: 194px; width: auto; height: auto; right: 0px; bottom: 140px; z-index: 3;" anchor="0b0101" dock="5" ui-id="PN_contents" ui-class="UIPanel" dock-r="left:0px;top:194px;width:1280px;height:100px;right:auto;bottom:auto" dock-h="100" dock-w="1280"><span class="ui-control ui-label" id="ui-171ab4a94c0" style='left: 83px; top: 46px; width: 441px; height: 34px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-family: "IBK iDream M"; font-size: 24px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_label44" ui-class="UILabel"><span class="ui-content" style="align-items: flex-start;">캐시백 사용 신청정보</span></span><div class="ui-control ui-panel ui-container" id="ui-170ec4084d5" style="left: 83px; top: 84px; width: 1121px; height: 110px; right: auto; bottom: auto; z-index: 1;" anchor="0b0101" dock="0" ui-id="PN_panel_card" ui-class="UIPanel"></div><span class="ui-control ui-label" id="ui-172c00c6687" style='left: 83px; top: 375px; width: 441px; height: 42px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-family: "IBK iDream M"; font-size: 24px; z-index: 2;' anchor="0b0101" dock="0" ui-id="LB_label1" ui-class="UILabel"><span class="ui-content" style="align-items: flex-start;">TOP 포인트 보유현황</span></span><span disabled="disabled" class="ui-control ui-textbox ui-disabled" id="ui-171a5770f82" style="border-width: 2px; left: 83px; top: 276px; width: 1121px; height: 54px; right: auto; bottom: auto; color: rgb(0, 0, 0); font-size: 21px; z-index: 3;" anchor="0b0101" dock="0" ui-id="TB_textbox_acct" ui-class="UITextBox"><span><input class="ui-input" type="text" maxlength="32767" value="결제계좌 : 계좌번호"></span></span><span class="ui-control ui-label" id="ui-172c10145e0" style='left: 83px; top: 240px; width: 441px; height: 42px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-family: "IBK iDream M"; font-size: 24px; z-index: 4;' anchor="0b0101" dock="0" ui-id="LB_label2" ui-class="UILabel"><span class="ui-content" style="align-items: flex-start;">결제 계좌</span></span><div class="ui-control ui-table" id="ui-172c12f7fc6" style="border-width: 2px; border-color: rgb(194, 194, 194); left: 83px; top: 412px; width: 1121px; height: 180px; right: auto; bottom: auto; z-index: 5;" anchor="0b0101" dock="0" ui-id="TL_table_pt_use" ui-class="UITable"><table border="0" cellspacing="0" cellpadding="0"><thead><tr><td width="270" type="1" align-v="align-middle" align-h="align-left"></td><td type="1" align-v="align-middle" align-h="align-left"></td></tr></thead><tbody><tr height="33%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-172c12f7fc8" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">전환 가능 포인트</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-172c12f7fc9" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"><span class="cell-control-label">0</span></div></td></tr><tr height="33%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-172c12f7fca" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">전환 신청 포인트</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-172c12f7fcb" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"><span class="ui-control ui-textbox" id="ui-172c13403e9" style="left: 7px; top: 4px; width: 820px; height: 48px; right: auto; bottom: auto; font-size: 18px; z-index: 0;" anchor="0b0101" dock="0" ui-id="TB_textbox_point" ui-class="UITextBox" xonclick="TB_textbox_point_OnClick"><span><input class="ui-input" type="text" maxlength="32767" value=""></span></span></div></td></tr><tr height="34%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-172c12f7fcc" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">잔여 포인트</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-172c12f7fcd" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"><span class="cell-control-label">0</span></div></td></tr></tbody></table></div></div></div></div><xcomponent></xcomponent><xjscript><script id='xjscript' type='text/plain'>// common.js import
importJSS("common", "common.js");

var p = parent;

function Form_OnLoad(e){

}

// 선택한 카드 리스트 
function selectCardDataList(){

    const cardData = p.G_cardDataStep4;
    const cardInfoAvailablePoint = p.G_cardInfoAvailablePointTopStep3;
    const cardInfoSelectPoint    = p.G_cardInfoSelectPointStep4_2;
   
    if(cardData != null){     
	      
	   console.log("cardData >>>> " + cardData + " >>>>>>  length  >>>>>>  " + cardData.length ); 	   
	 
	   // 리스트 초기화
	   let $PN_panel_card = $("div[ui-id='PN_panel_card']");
	   $PN_panel_card.html("");	   
	   
	   let tag = [];
	   
	   for(var i = 0, Len = cardData.length; i < Len; i++) {
	   
	     var record = cardData[i];
	     
	     if( i == p.G_cardsListInfoIndexStep4_1){
	         let vCDN = (record.CDN).substr(0,4) + "-****-****-" + (record.CDN).substr(record.CDN.length-4);
	         
	         // 카드번호 셋팅
	         p.G_cardInfoCDNStep4 = record.CDN;
	         
		     tag.push(""
				 +'<div class="list_info" onclick="cardSelectStep4(\''+i+'\');">'
		         +'	<div class="text_area">'
		         +'    <div class="main_text">' + record.RPRS_PDM + '</div>'
		         +'    <div class="sub_text">' + vCDN + '</div>'	        
		         +'	</div>'
		         +'  <div class="next_img"></div>'
		         +'</div>'	
			 );    	       
			
			 $PN_panel_card.append(""
				 +'<div class="list-panel">'
				 +tag.join("")
				 +'</div>'
		     );         
		     
			$PN_panel_card.find("> div.list-panel > div.list_info").each(function(i){
				let $this = $(this);
				$this.css({'border': '1px solid #9c9c9c'});
				$this.mousedown(function(){
				    comSelectAnimate.call(this,$("div[ui-id='PN_panel_card'] > div.list-panel > div.list_info"));
				});
			});
			$PN_panel_card.find("> div.list-panel > div.list_info").css("visibility","visible");			     
		     
	      }  // end if - 한 건만 리스트 표시
	      
	   }  // end for - cardData
	   
    }  // end if - cardData
	
	
	  // 전환 가능 포인트 셋팅
	  TL_table_pt_use.DataCell(0,1,"text",com.util.fnGetFormatMoney(cardInfoAvailablePoint));
		  
	  if(!com.util.isNull(cardInfoSelectPoint)){  // 사용할(입력한) 포인트가 있으면....
	   	 let $table_pt_use = $("div[ui-id='TL_table_pt_use']");
		 $table_pt_use.find("> table > tbody > tr:eq(1)").find("> td:eq(1) > div > span[ui-id='TB_textbox_point'] > span > input[type=text]")
		  												 .attr("placeholder","1단위 입력")
		  												 .css('font-size','22px')
													     .val(com.util.fnGetFormatMoney(cardInfoSelectPoint));
		 // 포인트 사용 신청 확인 버튼 활성화										    	
		 BT_right.Enabled = true;
	  } else { // 사용할(입력한) 포인트가 없으면....
	   	 let $table_pt_use = $("div[ui-id='TL_table_pt_use']");
		 $table_pt_use.find("> table > tbody > tr:eq(1)").find("> td:eq(1) > div > span[ui-id='TB_textbox_point'] > span > input[type=text]")
		 												 .attr("placeholder","1단위 입력")
		 												 .css('font-size','22px')
													     .val("");
		 // 포인트 사용 신청 확인 버튼 비활성화
		 BT_right.Enabled = false;
	  }
		
	  // 사용하고 남을 포인트 계산(잔여포인트 셋팅)
	  if(!com.util.isNull(cardInfoSelectPoint)){  
		 // 잔여 포인트	
		 TL_table_pt_use.DataCell(2,1,"text",com.util.fnGetFormatMoney(parseInt(cardInfoAvailablePoint) - parseInt(cardInfoSelectPoint)));			
	  } else {
		 // 잔여 포인트	
	     TL_table_pt_use.DataCell(2,1,"text",com.util.fnGetFormatMoney(cardInfoAvailablePoint));			
	  } 
		
}


// 신규 조회시 카드 리스트 
function initCardDataList(xioOutput){

		console.log("searchCardPointUseStep4 STLM_ACN_HST_ROWCOUNT : " + xioOutput.STLM_ACN_HST_ROWCOUNT);
		console.log("searchCardPointUseStep4 Grid1 : " + xioOutput.Grid1);
		 								
	   // 리스트 초기화
	   let $PN_panel_card = $("div[ui-id='PN_panel_card']");
	   $PN_panel_card.html("");	   
	   
	   let tag = [];		 								
		 								
		const records = xioOutput.Grid1;
		
		// 전역변수에 별도 할당
		p.G_cardDataStep4 = records; 
		
		for(let i = 0, Len = records.length; i < Len; i++){
		    let record = records[i];
            console.log("CDN >>>> " + record.CDN);  // 카드번호
            console.log("RPRS_PDM >>>> " + record.RPRS_PDM);    // 대표상품명
            console.log("STLM_BNCD >>>> " + record.STLM_BNCD);
            console.log("STLM_ACN >>>> " + record.STLM_ACN);    
            
            if(i == 0){
            
                let vCDN = (record.CDN).substr(0,4) + "-****-****-" + (record.CDN).substr(record.CDN.length-4);
                
		        // 카드번호 셋팅
		        p.G_cardInfoCDNStep4 = record.CDN;
     
			    tag.push(""
					+'<div class="list_info" onclick="cardSelectStep4(\''+i+'\');">'
			        +'	<div class="text_area">'
			        +'    <div class="main_text">' + record.RPRS_PDM + '</div>'
			        +'    <div class="sub_text">' + vCDN + '</div>'	        
			        +'	</div>'
			        +'  <div class="next_img"></div>'
			        +'</div>'	
				);    	       
				
				$PN_panel_card.append(""
					+'<div class="list-panel">'
					+tag.join("")
					+'</div>'
				);				
				
				$PN_panel_card.find("> div.list-panel > div.list_info").each(function(i){
					let $this = $(this);
					$this.css({'border': '1px solid #9c9c9c'});
					$this.mousedown(function(){
					    comSelectAnimate.call(this,$("div[ui-id='PN_panel_card'] > div.list-panel > div.list_info"));
					});
				});
				$PN_panel_card.find("> div.list-panel > div.list_info").css("visibility","visible");					
				
				// 결제은행 : 결제계좌
				if(record.STLM_BNCD == "003"){  // 당행
				   TB_textbox_acct.Text = com.acct.convertBankName(record.STLM_BNCD) + " : " + com.acct.fnGetAccountPattern(record.STLM_ACN);
				} else {  // 타행
				   TB_textbox_acct.Text = com.acct.convertBankName(record.STLM_BNCD) + " : " + record.STLM_ACN;
				}
				
			}  // end if - 한 건만 리스트 표시
            
		}  // end for - records			
						
		// 전환 가능 포인트
		TL_table_pt_use.DataCell(0,1,"text",com.util.fnGetFormatMoney(p.G_cardInfoAvailablePointTopStep3));
		
		// 잔여 포인트	
		TL_table_pt_use.DataCell(2,1,"text",com.util.fnGetFormatMoney(p.G_cardInfoAvailablePointTopStep3));			
		
		// 전환 신청 포인트
		let $table_pt_use = $("div[ui-id='TL_table_pt_use']");
		$table_pt_use.find("> table > tbody > tr:eq(1)").find("> td:eq(1) > div > span[ui-id='TB_textbox_point'] > span > input[type=text]")
												    	.attr("placeholder","1단위 입력")
												    	.css('font-size','22px')
												    	.val("");
												    	
	    // 포인트 사용 신청 확인 버튼 비활성화
	    BT_right.Enabled = false;
}


// 포인트를 전환 신청할 카드 리스트 클릭 이벤트
function cardSelectStep4(idx) {
   console.log(">>>>>>>>>>>>>>>>> cardSelectStep4 === idx === " + idx );		  
   // 포인트 사용신청 - 포인트 전환 신청할 카드 리스트 화면 조회
   p.sendRequest("step4_1_point_cashuse_card");  
}

function TB_textbox_point_OnClick(e){
   // 포인트 사용신청 - 포인트 입력패드 화면 조회
   p.sendRequest("step4_2_point_com_numpad");   
}


function BT_left_OnClick(e){
	SCREEN.WriteJnl("[현금 캐시백 신청] 취소");
  	ATMCOMM.BusinessEnd(ATMCOMM.RET_CAN);
}


function BT_right_OnClick(e){
   // 포인트 사용신청 - 현금캐시백 사용(대한항공 마일리지 전환) 신청 진행 안내 화면 조회
   SCREEN.WriteJnl("[현금 캐시백 신청] 정상");
   p.sendRequest("step5_point_guide");   
}
</script></xjscript></body>
</html>
