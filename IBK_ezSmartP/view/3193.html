<!doctype html>
<html version="1000">
<head>
	<meta charset="utf-8">
	<title>ezSmartAtm Builder Form 새문서</title>
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="[김윤섭][kkobiboy]">
	<link id="ui-style-core" rel="stylesheet" type="text/css" href="/core/app.controls.css">
	<script type="text/javascript" charset="utf-8" src="/HtaPlatform/Core/Form.JsApi"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.jquery.js"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.controls.js"></script>
	<style id="ui-style-user" type="text/css"></style>
	<script id="ui-script-user" type="text/javascript"></script>
</head>
<body oncontextmenu="return false;" class="ui-pre-load"><div class="ui-document ui-container" id="ui-document" lang="kr" xonload="Form_OnLoad" ide-size="1389,1120" anchor="0b0101" dock="5" ui-id="Form" ui-class="UIForm">
<div class="ui-control ui-panel ui-container" id="ui-171be2e0c07" style="left: 0px; top: 0px; width: 1280px; height: 1024px; right: auto; bottom: auto; z-index: 0; background-color: transparent;" anchor="0b0101" dock="0" ui-id="PN_form" ui-class="UIPanel"><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171be2e0c08" style="left: 0px; top: 0px; width: auto; height: 102px; right: 0px; bottom: auto; z-index: 0; background-color: rgb(23, 107, 200);" anchor="0b0101" dock="1" ui-id="PN_Title" ui-class="UIPanel" dock-r="left:98px;top:1px;width:200px;height:76px;right:auto;bottom:auto" dock-h="102" dock-w="200"><span class="ui-control ui-label" id="ui-171be2e0c09" style='left: 80px; top: 31px; width: 1120px; height: 40px; right: auto; bottom: auto; color: white; font-family: "IBK iDream M"; font-size: 38px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_title" ui-class="UILabel"><span class="ui-content">선결제</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171be2e0c0a" style="left: 0px; top: 102px; width: auto; height: 92px; right: 0px; bottom: auto; z-index: 1; background-color: rgb(239, 240, 242);" anchor="0b0101" dock="1" ui-id="PN_Subtitle" ui-class="UIPanel" dock-r="left:0px;top:102px;width:1280px;height:92px;right:auto;bottom:auto" dock-h="92" dock-w="1280"><div class="ui-control ui-panel ui-container" id="ui-17355fb3e22" style="left: 80px; top: 12px; width: 1150px; height: 68px; right: auto; bottom: auto; z-index: 0; background-color: rgb(239, 240, 242);" anchor="0b0101" dock="0" ui-id="PN_Subtitle_wrap" ui-class="UIPanel"><span class="ui-control ui-label" id="ui-172bff56e8d" style='left: 240px; top: 19px; width: 780px; height: 30px; right: auto; bottom: auto; font-family: "IBK iDream L"; font-size: 20px; z-index: 2;' anchor="0b0101" dock="0" ui-id="LB_Subtitle_guide" ui-class="UILabel"><span class="ui-content">청구금액/미청구금액의 전체결제를 신청하시겠습니까?</span></span><span class="ui-control ui-label" id="ui-172bfef05a8" style='left: 208px; top: 19px; width: 13px; height: 34px; right: auto; bottom: auto; font-family: "IBK iDream L"; font-size: 20px; z-index: 1;' anchor="0b0101" dock="0" ui-id="LB_label10" ui-class="UILabel" icon-image-align="left,middle"><span class="ui-content" style="justify-content: center;"> | </span></span><span class="ui-control ui-label" id="ui-171be2e0c0b" style='left: 4px; top: 13px; width: 180px; height: 43px; right: auto; bottom: auto; font-family: "IBK iDream L"; font-size: 32px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_Subtitle" ui-class="UILabel"><span class="ui-content">선결제 신청</span></span></div></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-bottom" id="ui-172729dbaaf" style="left: 0px; top: auto; width: auto; height: 140px; right: 0px; bottom: 0px; z-index: 2;" anchor="0b0101" dock="2" ui-id="PN_btn" ui-class="UIPanel" dock-r="left:0px;top:884px;width:1280px;height:140px;right:auto;bottom:auto" dock-h="140" dock-w="1280"><span class="ui-control ui-button theme-orange" id="ui-172729e45a9" style='left: 36px; top: 31px; width: 258px; height: 80px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 0;' anchor="0b0101" dock="0" ui-id="BT_left" ui-class="UIButton" theme="orange" xonclick="BT_left_OnClick"><span class="ui-content">취소</span></span><span class="ui-control ui-button theme-blue" id="ui-172729ea59d" style='left: auto; top: 31px; width: 258px; height: 80px; right: 36px; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 1;' anchor="0b1001" dock="0" ui-id="BT_right" ui-class="UIButton" theme="blue" xonclick="BT_right_OnClick"><span class="ui-content">확인</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-fill" id="ui-172729f3b0f" style="left: 0px; top: 194px; width: auto; height: auto; right: 0px; bottom: 140px; z-index: 3;" anchor="0b0101" dock="5" ui-id="PN_contents" ui-class="UIPanel" dock-r="left:0px;top:194px;width:1280px;height:100px;right:auto;bottom:auto" dock-h="100" dock-w="1280"><div class="ui-control ui-panel ui-container" id="ui-172ea605b36" style="left: 83px; top: 20px; width: 1100px; height: 660px; right: auto; bottom: auto; z-index: 0;" anchor="0b0101" dock="0" ui-id="PN_wrap" ui-class="UIPanel"><span class="ui-control ui-label" id="ui-172ea60f7fe" style="left: 16px; top: 16px; width: 441px; height: 32px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-size: 26px; z-index: 0;" anchor="0b0101" dock="0" ui-id="LB_label2" ui-class="UILabel"><span class="ui-content">결제계좌정보</span></span><span class="ui-control ui-label" id="ui-172ea60f829" style="left: 734px; top: 20px; width: 119px; height: 24px; right: auto; bottom: auto; font-size: 21px; z-index: 1;" anchor="0b0101" dock="0" ui-id="LB_label3" ui-class="UILabel"><span class="ui-content">조회기준일시</span></span><span class="ui-control ui-label" id="ui-172ea60f855" style="left: 861px; top: 20px; width: 210px; height: 24px; right: auto; bottom: auto; font-size: 21px; z-index: 2;" anchor="0b0101" dock="0" ui-id="LB_label_date" ui-class="UILabel"><span class="ui-content"></span></span><div class="ui-control ui-panel ui-container" id="ui-172ea6174b0" style="left: 16px; top: 55px; width: 1050px; height: 194px; right: auto; bottom: auto; z-index: 3;" anchor="0b0101" dock="0" ui-id="PN_account" ui-class="UIPanel"></div><span class="ui-control ui-label" id="ui-172ea623a68" style="left: 16px; top: 266px; width: 441px; height: 32px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-size: 26px; z-index: 4;" anchor="0b0101" dock="0" ui-id="LB_label5" ui-class="UILabel"><span class="ui-content">청구금액</span></span><div class="ui-control ui-table" id="ui-172c12f7fc6" style="border-width: 2px; border-color: rgb(194, 194, 194); left: 16px; top: 310px; width: 1050px; height: 180px; right: auto; bottom: auto; z-index: 5;" anchor="0b0101" dock="0" ui-id="TL_table_payinfo" ui-class="UITable"><table border="0" cellspacing="0" cellpadding="0"><thead><tr><td width="270" type="1" align-v="align-middle" align-h="align-left"></td><td type="1" align-v="align-middle" align-h="align-left"></td></tr></thead><tbody><tr height="33%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173bd05a9d2" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">합계총액(A+B)</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173bd05a9d3" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"></div></td></tr><tr height="33%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173bd05a9d4" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">당월 청구금액(A)</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173bd05a9d5" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"></div></td></tr><tr height="34%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173bd05a9d6" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">미청구금액(B)</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173bd05a9d7" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"></div></td></tr></tbody></table></div><div class="ui-control ui-table" id="ui-173bd07a207" style="border-width: 2px; border-color: rgb(194, 194, 194); left: 16px; top: 554px; width: 1050px; height: 90px; right: auto; bottom: auto; z-index: 6;" anchor="0b0101" dock="0" ui-id="TL_table_payamt" ui-class="UITable"><table border="0" cellspacing="0" cellpadding="0"><thead><tr><td width="270" type="1" align-v="align-middle" align-h="align-left"></td><td type="1" align-v="align-middle" align-h="align-left"></td></tr></thead><tbody><tr height="100%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173bd07a208" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">신청가능금액</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173bd07a209" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"><span class="ui-control ui-textbox" id="ui-1741fa9853e" style="left: 30px; top: 15px; width: 400px; height: 54px; right: auto; bottom: auto; z-index: 0;" anchor="0b0101" dock="0" ui-id="TB_textbox_amt" ui-class="UITextBox" xonclick="TB_textbox_amt_OnClick"><span><input class="ui-input" style="text-align: right;" type="text" maxlength="32767" value=""></span></span><span class="ui-control ui-label" id="ui-1741fababf2" style="left: 437px; top: 19px; width: 32px; height: 43px; right: auto; bottom: auto; z-index: 1;" anchor="0b0101" dock="0" ui-id="LB_label4" ui-class="UILabel"><span class="ui-content">원</span></span></div></td></tr></tbody></table></div><span class="ui-control ui-label" id="ui-173bd07a24f" style="left: 16px; top: 510px; width: 441px; height: 32px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-size: 26px; z-index: 7;" anchor="0b0101" dock="0" ui-id="LB_label1" ui-class="UILabel"><span class="ui-content">선결제신청</span></span></div><span class="ui-control ui-scrollbar" id="ui-172980bda14" style="left: 1220px; top: 20px; width: 32px; height: 660px; right: auto; bottom: auto; z-index: 1;" anchor="0b0101" dock="0" ui-id="SB_scrollbar_wrap" ui-class="UIScrollBar" scroll-control-id="PN_wrap"><span class="track"></span><span class="trackbutton" style="top: 467px;"></span></span></div></div></div><xcomponent></xcomponent><xjscript><script id='xjscript' type='text/plain'>// 3180.css import
importCSS("3180"     ,"3180.css");

// common.js import
//importJSS("common", "common.js");
includeJSS("common","/KRG/0301/common.js");

var p = parent;

function Form_OnLoad(e){

}


/* 결제계좌정보 출력 */
function fnSetAcnInfo( ){

  let ATLM_ACN = "", ACNT_BAL = 0, STLM_ACN = "", SUBJ_NM = "";

  // 결제계좌번호 가져오기    
  if(p.G_CRDRCP301021Step3 != null){
     STLM_ACN = p.G_CRDRCP301021Step3.STLM_ACN;
  }


  // 결제계좌정보 가져오기
  if(p.G_CBKARR108D10Step3 != null){
  
	  const records = p.G_CBKARR108D10Step3.Grid1;	
	  
	  for(let i = 0, Len = records.length; i < Len; i++){
	      let record = records[i];
	      
          if(STLM_ACN == record.CUS_ACN) {
             ATLM_ACN = record.CUS_ACN;
             ACNT_BAL = record.ACNT_BAL; 
             SUBJ_NM  = record.SUBJ_NM;
                        
             p.G_CRDRCP301021Step3.STLM_BNCD = "003";
             p.G_CRDRCP301021Step3.STLM_ACN = ATLM_ACN;
             p.G_CRDRCP301021Step3.ACNT_BAL = ACNT_BAL;
             break;
          }     
	  }  // end for - records
	  	  
	  
	// 계좌번호 셋팅
	if(p.G_isOthers){
	   // 타행인경우 계좌번호 패턴 X
	} else {
	   STLM_ACN = p.com.acct.fnGetAccountPattern(p.G_CRDRCP301021Step3.STLM_ACN);
	}
	  
	// 은행명 셋팅
	if(p.G_isOthers){
	   SUBJ_NM = p.com.acct.convertBankName(p.G_CRDRCP301021Step3.STLM_BNCD);
	} else {
	   // 당행은 별도 처리 없음
	}
	
	const LASTBILGYMD =  p.com.date.fnGetFormatDate(p.G_CRDRCP301021Step3.LAST_BILG_YMD);

    let tag = [];
	tag.push(""
		+'<div class="list_info_pay" onclick="acctSelectPop();">'
        +'	<div class="text_area">'
        +'    <div class="main_text posLT"><strong>'+STLM_ACN+'</strong></div>'
        +'    <div class="sub_text posLB">'+SUBJ_NM+'</div>'
        +'    <div class="posRT">출금가능금액</div>'
        +'    <div class="posRB">'
        +		'<strong>'+p.com.util.fnGetFormatMoney(ACNT_BAL)+'</strong>'
        +		'<span>원</span>'
        +'	  </div>'
        +'	</div>'
        +'  <div class="next_img"></div>'
        +'  <div class="text_area_bottom"><span>최종 청구일</span> <div class="divider">|</div> <span>'+LASTBILGYMD+'</span> </div>'
        +'</div>'	
	);

	let $PN_account = $("div[ui-id='PN_account']");
	$PN_account.html(""
		+'<div class="list-panel">'
		+tag.join("")
		+'</div>'
	);
	
	// mousedown 이벤트 삭제					   
    $PN_account.find("> div.list-panel > div.list_info_pay").unbind("mousedown");
    // mousedown 이벤트 생성
	$PN_account.find("> div.list-panel > div.list_info_pay").each(function(i){
		let $this = $(this);
		$this.css({'border': '1px solid #9c9c9c'});
		$this.mousedown(function(){
		    comSelectAnimate.call(this,$("div[ui-id='PN_account'] > div.list-panel > div.list_info_pay"));
		});
	});
	$PN_account.find("> div.list-panel > div.list_info_pay").css("visibility","visible");	
	  
  }  // end if - G_CBKARR108D10Step3
	
}


function acctSelectPop(){
   // 출금계좌 리스트 팝업 실행화면
   com.ss.setItem("pop_accountAll_act","3193");
   
   // 전체계좌 팝업 조회
   p.sendRequest("pop_accountAll");     
}
     
var TOTSTTTALAMT = 0,
    TCRDTMNBAMT  = 0,
    TUDEMTTALAMT = 0;

function fnCreatePaymentInfo(){

   // 테이블셀 초기화
   TL_table_payinfo.DataCell(0,1,"text","");
   TL_table_payinfo.DataCell(1,1,"text","");
   TL_table_payinfo.DataCell(2,1,"text","");
   
   const records = p.G_CRDRCP301021Step3.Grid1,
   		 lastBilgYmd = parseInt(p.G_CRDRCP301021Step3.LAST_BILG_YMD, 10);
  
   for(let i = 0, Len = records.length; i < Len; i++){
       let record = records[i],
           stlmYmd = parseInt(record.STLM_YMD, 10),
    	   temp = parseInt(record.OTST_TTAL_AMT, 10);
         
        if(stlmYmd > lastBilgYmd) {
            TUDEMTTALAMT+= temp;
        } else {
            TCRDTMNBAMT += temp;
        }
   }  // end for - records
   
   console.log(" fnCreatePaymentInfo >>> TCRDTMNBAMT ::: " + TCRDTMNBAMT); 
   console.log(" fnCreatePaymentInfo >>> TUDEMTTALAMT ::: " + TUDEMTTALAMT); 

    // 합계총액
    TOTSTTTALAMT = TCRDTMNBAMT + TUDEMTTALAMT;
    TL_table_payinfo.DataCell(0,1,"text",com.util.fnGetFormatMoney(TOTSTTTALAMT));
    
    // 당월청구금액
	TL_table_payinfo.DataCell(1,1,"text",com.util.fnGetFormatMoney(TCRDTMNBAMT));
	
    // 미청구금액
	TL_table_payinfo.DataCell(2,1,"text",com.util.fnGetFormatMoney(TUDEMTTALAMT));

	const $payinfo_tbody = TL_table_payinfo.$.find("> table > tbody");
	$payinfo_tbody.find("> tr:eq(0) > td:eq(1) > div.ui-table-cell > span.cell-control-label").append('<span class="table-won"> 원</span>');
	$payinfo_tbody.find("> tr:eq(1) > td:eq(1) > div.ui-table-cell > span.cell-control-label").append('<span class="table-won"> 원</span>');
	$payinfo_tbody.find("> tr:eq(2) > td:eq(1) > div.ui-table-cell > span.cell-control-label").append('<span class="table-won"> 원</span>');
	
   	 let $table_payamt = $("div[ui-id='TL_table_payamt']");
	 $table_payamt.find("> table > tbody > tr:eq(0)").find("> td:eq(1) > div > span[ui-id='TB_textbox_amt'] > span > input[type=text]")
												     .val(com.util.fnGetFormatMoney(TOTSTTTALAMT));
												     
     // 신용카드입금총금액 셋팅
	 p.G_CRDRCP301021Step3.TEMP_CRD_MNRC_TTAL_AMT = TOTSTTTALAMT.toString();										     
     p.G_CRDRCP301021Step3.CRD_MNRC_TTAL_AMT = TOTSTTTALAMT.toString();
	 				    
}


function BT_left_OnClick(e){
	SCREEN.WriteJnl("[선결제 금액결제 신청] 취소");
  	ATMCOMM.BusinessEnd(ATMCOMM.RET_CAN);
}


function BT_right_OnClick(e){
  
   if(p.G_isOthers && p.comFnOthersCheck() == false) return;
    
   // 신용카드입금총금액
   var CRD_MNRC_TTAL_AMT = p.G_CRDRCP301021Step3.TEMP_CRD_MNRC_TTAL_AMT;

   // 매출건별입금 배열 건수 재셋팅
   com.ss.setItem("3183_CSTP_MNRC_ROWCOUNT","0");

   // 신용카드입금총금액 재셋팅
   p.G_CRDRCP301021Step3.CRD_MNRC_TTAL_AMT = CRD_MNRC_TTAL_AMT;
   com.ss.setItem("3183_CRD_MNRC_TTAL_AMT",CRD_MNRC_TTAL_AMT);
    
   if(p.G_isOthers && p.comFnOthersCheck()){
      // 타행은 비밀번호 입력 패스 
      p.G_SkipPwdStep3 = true;
   }    
   SCREEN.WriteJnl("[선결제 금액결제 신청] 정상");
   // 선결제 - 할부 건별 신청 안내 화면 조회02
   p.sendRequest("step4_2_pay_guide");
   
}


function TB_textbox_amt_OnClick(e){
   // 선결제 - P-AType(일시불결제)(금액결제(A)) 타입 화면 금액 입력 팝업 조회
   p.sendRequest("m1_pop_payAmtKeypad");
}</script></xjscript></body>
</html>
