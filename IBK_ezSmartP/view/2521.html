<!doctype html>
<html version="1000">
<head>
	<meta charset="utf-8">
	<title>ezSmartAtm Builder Form 새문서</title>
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="[김윤섭][kkobiboy]">
	<link id="ui-style-core" rel="stylesheet" type="text/css" href="/core/app.controls.css">
	<script type="text/javascript" charset="utf-8" src="/HtaPlatform/Core/Form.JsApi"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.jquery.js"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.controls.js"></script>
	<style id="ui-style-user" type="text/css"></style>
	<script id="ui-script-user" type="text/javascript"></script>
</head>
<body oncontextmenu="return false;" class="ui-pre-load"><div class="ui-document ui-container" id="ui-document" lang="kr" ide-size="1280,1024" anchor="0b0101" dock="5" ui-id="Form" ui-class="UIForm">
<div class="ui-control ui-panel ui-container" id="ui-171be2e0c07" style="left: 0px; top: 0px; width: 1280px; height: 1024px; right: auto; bottom: auto; z-index: 0; background-color: transparent;" anchor="0b0101" dock="0" ui-id="PN_container" ui-class="UIPanel"><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171be2e0c08" style="left: 0px; top: 0px; width: auto; height: 101.97px; right: 0px; bottom: auto; z-index: 0; background-color: rgb(23, 107, 200);" anchor="0b0101" dock="1" ui-id="PN_Title" ui-class="UIPanel" dock-w="200" dock-h="102" dock-r="left:98px;top:1px;width:200px;height:76px;right:auto;bottom:auto"><span class="ui-control ui-label" id="ui-171be2e0c09" style='left: 80px; top: 31px; width: 1120px; height: 40px; right: auto; bottom: auto; color: white; font-family: "IBK iDream M"; font-size: 38px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_title" ui-class="UILabel"><span class="ui-content">보험</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171a52210e4" style="left: 0px; top: 101.97px; width: auto; height: 91.36px; right: 0px; bottom: auto; z-index: 1; background-color: whitesmoke;" anchor="0b0101" dock="1" ui-id="PN_Subtitle" ui-class="UIPanel" dock-w="1280" dock-h="91" dock-r="left:0px;top:92px;width:1280px;height:112px;right:auto;bottom:auto"><span class="ui-control ui-label" id="ui-171be2e0c0b" style='left: 82px; top: 30px; width: 1120px; height: 32px; right: auto; bottom: auto; font-family: "IBK iDream L"; font-size: 28px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_subTitle" ui-class="UILabel"><span class="ui-content">입금내역조회</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-bottom" id="ui-171a4b083a4" style="left: 0px; top: auto; width: auto; height: 140px; right: 0px; bottom: 0px; z-index: 2; background-color: transparent;" anchor="0b0101" dock="2" ui-id="PN_btn" ui-class="UIPanel" dock-w="1280" dock-h="140" dock-r="left:0px;top:884px;width:1280px;height:140px;right:auto;bottom:auto"><span class="ui-control ui-button theme-blue" id="ui-171a4b083a5" style='left: auto; top: 31px; width: 258px; height: 80px; right: 36px; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 0;' anchor="0b1001" dock="0" ui-id="BT_right" ui-class="UIButton" theme="blue" xonclick="BT_right_OnClick"><span class="ui-content">조회</span></span><span class="ui-control ui-button theme-orange" id="ui-171a4b083a6" style='left: 36px; top: 31px; width: 258px; height: 80px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 1;' anchor="0b0101" dock="0" ui-id="BT_left" ui-class="UIButton" theme="orange" xonclick="BT_left_OnClick"><span class="ui-content">닫기</span></span></div><span class="ui-control ui-label" id="ui-1721784f6b1" style='left: 78px; top: 252px; width: 494px; height: 30px; right: auto; bottom: auto; color: rgb(0, 104, 196); font-family: "IBK iDream M"; font-size: 24px; z-index: 3;' anchor="0b0101" dock="0" ui-id="LB_label1" ui-class="UILabel"><span class="ui-content">보험선택</span></span><div class="ui-control ui-panel ui-container" id="ui-17225659336" style="left: 78px; top: 456px; width: 1085px; height: 428px; right: auto; bottom: auto; z-index: 4;" anchor="0b0101" dock="0" ui-id="PN_accountList" ui-class="UIPanel"></div><span class="ui-control ui-scrollbar" id="ui-1721787f7d3" style="left: 1209px; top: 456px; width: 32px; height: 428px; right: auto; bottom: auto; z-index: 5;" anchor="0b0101" dock="0" ui-id="SB_scrollbar1" ui-class="UIScrollBar" scroll-control-id="PN_accountList"><span class="track"></span><span class="trackbutton" style="top: 0px;"></span></span><span class="ui-control ui-combobox" id="ui-1736a0b1bb7" style="left: 78px; top: 287px; width: 1085px; height: 54px; right: auto; bottom: auto; font-size: 22px; z-index: 6;" anchor="0b0101" dock="0" ui-id="DL_accountListBox" ui-class="UIComboBox" xonselecteditemchanged="DL_accountListBox_OnSelectedItemChanged"><span class="ui-content"></span><span class="ui-icon-image" fontsize="16">▼ </span><select><option selected="selected"></option></select></span><span class="ui-control ui-label" id="ui-1736a0f3df9" style='left: 78px; top: 428px; width: 494px; height: 30px; right: auto; bottom: auto; color: black; font-family: "Noto sans CJK KR", "맑은 고딕", "Arial", "IBK IDream L", "IBK IDream M", "IBK IDream B", "IBK IDream EB", "IBK IDream Symbol", "IBK IWishR"; font-size: 18px; z-index: 7;' anchor="0b0101" dock="0" ui-id="LB_label2" ui-class="UILabel"><span class="ui-content">조회결과</span></span><span class="ui-control ui-label" id="ui-1736a115363" style='left: 572px; top: 428px; width: 591px; height: 30px; right: auto; bottom: auto; color: black; font-family: "Noto sans CJK KR", "맑은 고딕", "Arial", "IBK IDream L", "IBK IDream M", "IBK IDream B", "IBK IDream EB", "IBK IDream Symbol", "IBK IWishR"; font-size: 18px; z-index: 8;' anchor="0b0101" dock="0" ui-id="LB_searchDate" ui-class="UILabel"><span class="ui-content" style="justify-content: flex-end;">조회기준일시</span></span><div class="ui-control ui-panel ui-container" id="ui-17226d717c1" style="left: 222px; top: 520px; width: 800px; height: 300px; right: auto; bottom: auto; z-index: 9;" anchor="0b0101" dock="0" ui-id="PN_nullData" ui-class="UIPanel"><div class="ui-control ui-panel ui-container" id="ui-17226ce462d" style="left: 364px; top: 77px; width: 73px; height: 75px; right: auto; bottom: auto; z-index: 0;" anchor="0b0101" dock="0" ui-id="PN_panel7" ui-class="UIPanel"><span class="ui-back-image" style='background-image: url("/KRG/media/no_data_ic.png");'></span></div><span class="ui-control ui-label" id="ui-17226cd18f8" style='left: 0px; top: 171px; width: 800px; height: 48px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 36px; z-index: 1;' anchor="0b0101" dock="0" ui-id="LB_label4" ui-class="UILabel"><span class="ui-content" style="justify-content: center;">거래내역이 없습니다.</span></span></div></div></div><xcomponent></xcomponent><xjscript><script id='xjscript' type='text/plain'>includeJSS("LibCommon","/KRG/0301/common.js"); // LibUtil import
/*
	#2521 - 보험 납입내역조회
*/
let p = parent;
let currentObj = {}; // 현재 화면에서 컨트롤할 객체
let retObj = {};	 // 화면에서 리턴시켜줄 객체
let comboAcn = ""; 	// 계좌번호 저장할 값 
let comboCd = ""; 	// 보험사코드 저장할 값 
let prevFlag;

// 닫기버튼
function BT_left_OnClick(e){
	// prevFlag : true면 보험 계좌정보 화면으로 복귀..
	if(prevFlag){
		p.ChangeTab("2516");
	} else {
		p.ChangeTab("2511");
	}
}

// 조회 or 계속조회 버튼
function BT_right_OnClick(e){
	retObj.BNCS_ISCM_CD = comboCd;
	retObj.SCN = comboAcn;
	retObj.bancaRecordArray = currentObj.bancaRecordArray;

	if(comboCd.substring(0,1)=="L"){
    	// IASIAZA1310X 생명보험 납입내역 조회 - Banca L
    	p.sendRequest("searchBancaLTranList", retObj);
    }else{
    	// IASIAZA1320X 상해보험 납입내역 조회 - Banca N
    	p.sendRequest("searchBancaNTranList", retObj);
    }
}

// 콤보박스 선택 변경 이벤트
function DL_accountListBox_OnSelectedItemChanged(e){
	let splitValue = e.after.value;
	console.log(splitValue)
	comboAcn = splitValue.split('|')[0].trim();
	comboCd = splitValue.split('|')[1].trim();
}

// 수신 데이터 처리
function ReceiveTran(obj){
	console.log(obj);
	prevFlag = obj.prevFlag;

	// 값 할당
	currentObj = {
		SCN : obj.SCN || "",				// 증권번호
		CNTC_NM : obj.CNTC_NM,				// 계약자명
		ISCM_NM : obj.ISCM_NM,				// 보험사명
		BNCS_ISCM_CD : obj.BNCS_ISCM_CD,	// 보험사코드
		bancaRecordArray : obj.bancaRecordArray,
		tranId : obj.tranId
	}
	
	let index;
	// 콤보박스 셋팅
	DL_accountListBox.setItemList([]);
	let bMap = obj.bancaRecordArray;
	let comboBoxData = [];
	for(let i=0; i<bMap.acc.length; i++){
		const dataObj = {};
		console.log(JSON.stringify(bMap))
		dataObj.Text = bMap.list[i].PDM;
		dataObj.Value = bMap.acc[i] + "|" + bMap.list[i].BNCS_ISCM_CD;
		
		// 상품대분류코드가 52인경우 콤보박스에서 제외
		if(bMap.list[i].PDF_LRCD != "52"){
			comboBoxData.push(dataObj);
		}
		
		if(currentObj.SCN.trim() == bMap.acc[i].trim()){
			index = i;
		}
	}
	DL_accountListBox.setItemList(comboBoxData);
	DL_accountListBox.setSelectedIndex(index);
	
	// 초기변수 셋팅
   	comboAcn = currentObj.SCN;
    comboCd = currentObj.BNCS_ISCM_CD;
	
	// 조회시각 
	LB_searchDate.setText("조회기준일시 &nbsp;" + com.date.nowDate('.', ':')); // 현재시각
	
	// 거래내역
	let rows = obj.list;
	
	let rowCnt = 0; // 거래내역 카운트
	if(rows.length > 0){
		PN_nullData.Visible = false;
	
		// 리스트 컨테이너 생성
		let $PN_accountList = $("div[ui-id='PN_accountList']");
		$PN_accountList.html(""
			+'<div class="list-panel"></div>'
		);
		
		for(let i=0; i<rows.length; i++){
			let record = rows[i];
			MakeTranList(record, i);
		}
		
		// PN_accountList의 height를 list-panel의 height처럼 적용되게 .. 
		$panel = $("div.list-panel");
	
		if($panel[0].offsetHeight <= $panel[0].parentElement.clientHeight){
			$panel.height("100%");
		}
	
		// 기타 리스트 css 
		$panel.find(">div.list_info").css({'justify-content':'space-between', 'padding':'0 40px'});
		$panel.find(">div.list_info").each(function(i){
			let $this = $(this);
			
			$this.find(">div.text_area").css({'display':'flex','flex-direction':'row','padding-left':'20px', 'width':'auto'});
			$this.find(">div.text_area .main_text").css({'font-family':'Noto sans CJK KR', 'font-size':'24px'});
			$this.find(">div.text_area .sub_text").css({'font-family':'IBK iDream L', 'font-size':'18px'});
			$this.find(">div.text_area_balance").css({'display':'flex','flex-direction':'column','font-size':'20px'});
			$this.find(">div.text_area_balance div.balance").css({'display':'flex','justify-content':'flex-end'});
			$this.find(">div.text_area_balance div.balance span").css({'margin-right':'5px'});
			$this.find(">div.text_area_balance div.balance span.won").css({'font-size':'24px'});
			$this.find("div.img").css({'width':'45px','display':'flex', 'align-items':'center', 'justify-content':'flex-start', 'margin-right':'20px'});
		});
	} else {
		PN_nullData.Visible = true;
		PN_accountList.$.empty();
	}
	
	SB_scrollbar1.Invalidate();
}

// 거래내역 리스트 생성
function MakeTranList(row, index){
	let tag = [];
	let inot_name = ""; 		// 입,출금인
	let balanceTextColor = "";  // 입,출금 금액 컬러
	
	if(currentObj.tranId == "IASIAZA1310X"){ // 생명보험
		tag.push(""
			+'<div class="list_info">'
        	+'	<div class="text_area">'
			+'  	<div class="img"><img src="/KRG/media/ic_withdraw.png"/></div>'
			+'		<div>'
        	+'  		<div class="main_text usetype" style="margin-bottom:12px;">보험료</div>'
        	+'  		<div class="sub_text">' + p.ReturnFormatDateHyphen(row.PYMN_YMD) + '</div>'
			+'		</div>'
        	+'	</div>'
        	+'  <div class="text_area_balance">'
        	+'  	<div class="balance" style="margin-bottom:8px;"><span>' + parseInt(row.PYMN_TOB) + '</span><span> 회차</span></div>'
        	+'  	<div class="balance"><span style="color:#176bc8;" class="won">' + parseInt(row.RL_MNRC_AMT).toLocaleString() + '</span><span class="won"> 원</span></div>'
        	+'  </div>'
        	+'</div>' 
		);
	} else if(currentObj.tranId == "IASIAZA1320X"){ // 상해보험
		tag.push(""
			+'<div class="list_info">'
        	+'	<div class="text_area">'
			+'  	<div class="img"><img src="/KRG/media/ic_withdraw.png"/></div>'
			+'		<div>'
        	+'  		<div class="main_text usetype" style="margin-bottom:12px;">보험료</div>'
        	+'  		<div class="sub_text">' + p.ReturnFormatDateHyphen(row.PMCC_DSNC_VL) + '</div>'
			+'		</div>'
        	+'	</div>'
        	+'  <div class="text_area_balance">'
        	+'  	<div class="balance" style="margin-bottom:8px;"><span>' + parseInt(row.PYMN_TOB) + '</span><span> 회차</span></div>'
        	+'  	<div class="balance"><span style="color:#176bc8;" class="won">' + parseInt(row.RL_MNRC_AMT).toLocaleString() + '</span><span class="won"> 원</span></div>'
        	+'  </div>'
        	+'</div>' 
		);
	}

	let $panel = $("div[ui-id='PN_accountList'] div.list-panel");
	$panel.append(tag.join(""));
}</script></xjscript></body>
</html>
