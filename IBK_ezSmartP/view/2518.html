<!doctype html>
<html version="1000">
<head>
	<meta charset="utf-8">
	<title>ezSmartAtm Builder Form 새문서</title>
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="[김윤섭][kkobiboy]">
	<link id="ui-style-core" rel="stylesheet" type="text/css" href="/core/app.controls.css">
	<script type="text/javascript" charset="utf-8" src="/HtaPlatform/Core/Form.JsApi"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.jquery.js"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.controls.js"></script>
	<style id="ui-style-user" type="text/css"></style>
	<script id="ui-script-user" type="text/javascript"></script>
</head>
<body oncontextmenu="return false;" class="ui-pre-load"><div class="ui-document ui-container" id="ui-document" lang="kr" ide-size="1280,1024" anchor="0b0101" dock="5" ui-id="Form" ui-class="UIForm"><div class="ui-control ui-panel ui-container" id="ui-171be2e0c07" style="left: 0px; top: 0px; width: 1280px; height: 1024px; right: auto; bottom: auto; z-index: 0; background-color: transparent;" anchor="0b0101" dock="0" ui-id="PN_form" ui-class="UIPanel"><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171be2e0c08" style="left: 0px; top: 0px; width: auto; height: 102px; right: 0px; bottom: auto; z-index: 0; background-color: rgb(23, 107, 200);" anchor="0b0101" dock="1" ui-id="PN_Title" ui-class="UIPanel" dock-w="200" dock-h="102" dock-r="left:98px;top:1px;width:200px;height:76px;right:auto;bottom:auto"><span class="ui-control ui-label" id="ui-171be2e0c09" style='left: 80px; top: 31px; width: 1120px; height: 40px; right: auto; bottom: auto; color: white; font-family: "IBK iDream M"; font-size: 38px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_title" ui-class="UILabel"><span class="ui-content">계좌조회</span></span></div><div class="ui-control ui-panel ui-container" id="ui-171be2e0c0e" style="left: 0px; top: 194px; width: 1280px; height: 690px; right: auto; bottom: auto; z-index: 1;" anchor="0b0101" dock="0" ui-id="PN_panel5" ui-class="UIPanel"><span class="ui-control ui-label" id="ui-1721784f6b1" style='left: 82px; top: 59px; width: 494px; height: 30px; right: auto; bottom: auto; color: rgb(0, 104, 196); font-family: "IBK iDream M"; font-size: 24px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_label1" ui-class="UILabel"><span class="ui-content">계좌조회</span></span><span class="ui-control ui-label" id="ui-17217e23511" style='left: 610px; top: 59px; width: 494px; height: 30px; right: auto; bottom: auto; color: rgb(0, 104, 196); font-family: "IBK iDream M"; font-size: 24px; z-index: 1;' anchor="0b0101" dock="0" ui-id="LB_label17" ui-class="UILabel"><span class="ui-content">조회구분</span></span><span class="ui-control ui-radiobox round ui-checked ui-radiobox-3575610" id="ui-17217e270f0" style="left: 610px; top: 103px; width: 219px; height: 36px; right: auto; bottom: auto; z-index: 2;" anchor="0b0101" dock="0" ui-id="RB_typeAll" ui-class="UIRadioBox" xonclick="RB_typeAll_OnClick" x-style="round" value="all" group-name="type"><span class="ui-icon-image"><span></span></span><span class="ui-content">전체거래 내역</span></span><span class="ui-control ui-radiobox round" id="ui-17225612ef6" style="left: 831px; top: 103px; width: 219px; height: 36px; right: auto; bottom: auto; z-index: 3;" anchor="0b0101" dock="0" ui-id="RB_typeRecent" ui-class="UIRadioBox" xonclick="RB_typeRecent_OnClick" x-style="round" value="recent" group-name="type"><span class="ui-icon-image"><span></span></span><span class="ui-content">최근거래일 조회내역</span></span><span class="ui-control ui-label" id="ui-17225645899" style="left: 696px; top: 179px; width: 471px; height: 32px; right: auto; bottom: auto; font-size: 21px; z-index: 4;" anchor="0b0101" dock="0" ui-id="LB_totalBalance" ui-class="UILabel"><span class="ui-content" style="justify-content: flex-end;">잔액</span></span><div class="ui-control ui-panel ui-container" id="ui-17225659336" style="left: 82px; top: 230px; width: 1085px; height: 426px; right: auto; bottom: auto; z-index: 5;" anchor="0b0101" dock="0" ui-id="PN_accountList" ui-class="UIPanel"><div class="ui-control ui-panel ui-container" id="ui-17226d717c1" style="left: 143px; top: 63px; width: 800px; height: 300px; right: auto; bottom: auto; z-index: 0;" anchor="0b0101" dock="0" ui-id="PN_nullDataInfo" ui-class="UIPanel"><div class="ui-control ui-panel ui-container" id="ui-17226ce462d" style="left: 364px; top: 77px; width: 73px; height: 75px; right: auto; bottom: auto; z-index: 0;" anchor="0b0101" dock="0" ui-id="PN_panel7" ui-class="UIPanel"><span class="ui-back-image" style='background-image: url("/KRG/media/no_data_ic.png");'></span></div><span class="ui-control ui-label" id="ui-17226cd18f8" style='left: 0px; top: 171px; width: 800px; height: 48px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 36px; z-index: 1;' anchor="0b0101" dock="0" ui-id="LB_label4" ui-class="UILabel"><span class="ui-content" style="justify-content: center;">거래내역이 없습니다.</span></span></div></div><span class="ui-control ui-textbox" id="ui-1734683a2fe" style="border-color: rgb(205, 205, 205); left: 82px; top: 94px; width: 494px; height: 54px; right: auto; bottom: auto; font-size: 22px; z-index: 6;" anchor="0b0101" dock="0" ui-id="TB_accountNumber" ui-class="UITextBox"><span><input class="ui-input" type="text" maxlength="32767"></span></span><span class="ui-control ui-scrollbar" id="ui-1721787f7d3" style="left: 1200px; top: 230px; width: 32px; height: 426px; right: auto; bottom: auto; z-index: 7;" anchor="0b0101" dock="0" ui-id="SB_scrollbar1" ui-class="UIScrollBar" scroll-control-id="PN_accountList"><span class="track"></span><span class="trackbutton" style="top: 0px;"></span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171a52210e4" style="left: 0px; top: 102px; width: auto; height: 92px; right: 0px; bottom: auto; z-index: 2; background-color: whitesmoke;" anchor="0b0101" dock="1" ui-id="PN_Subtitle" ui-class="UIPanel" dock-w="1280" dock-h="92" dock-r="left:0px;top:92px;width:1280px;height:112px;right:auto;bottom:auto"><span class="ui-control ui-label" id="ui-171be2e0c0b" style='left: 82px; top: 30px; width: 1120px; height: 32px; right: auto; bottom: auto; font-family: "IBK iDream L"; font-size: 28px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_subTitle" ui-class="UILabel"><span class="ui-content">거래내역조회</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-bottom" id="ui-171a4b083a4" style="left: 0px; top: auto; width: auto; height: 140px; right: 0px; bottom: 0px; z-index: 3; background-color: transparent;" anchor="0b0101" dock="2" ui-id="PN_btn" ui-class="UIPanel" dock-w="1280" dock-h="140" dock-r="left:0px;top:884px;width:1280px;height:140px;right:auto;bottom:auto"><span class="ui-control ui-button theme-blue" id="ui-171a4b083a5" style='left: auto; top: 31px; width: 258px; height: 80px; right: 36px; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 0;' anchor="0b1001" dock="0" ui-id="BT_right" ui-class="UIButton" xonclick="BT_right_OnClick" theme="blue"><span class="ui-content">계속조회</span></span><span class="ui-control ui-button theme-orange" id="ui-171a4b083a6" style='left: 36px; top: 31px; width: 258px; height: 80px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 1;' anchor="0b0101" dock="0" ui-id="BT_left" ui-class="UIButton" xonclick="BT_left_OnClick" theme="orange"><span class="ui-content">닫기</span></span></div></div>
</div><xcomponent></xcomponent><xjscript><script id='xjscript' type='text/plain'>includeJSS("LibCommon","/KRG/0301/common.js"); // LibUtil import
/*
	#2518 - 거래내역조회(ATM)
	예금, 신탁, 퇴직연금
*/
let p = parent;
let currentObj = {}; // 현재 화면에서 컨트롤할 객체
let retObj = {};	 // 화면에서 리턴시켜줄 객체
let gubunFlag1 = false; // 계속조회 판단용
let gubunFlag2 = false; // 계속조회 판단용
let ymd1 = "";
let ymd2 = "";
let srn1 = "";
let srn2 = "";

// 닫기버튼
function BT_left_OnClick(e){
	// 내역 초기화 (empty)
	let $PN_accountList = $("div[ui-id='PN_accountList']");
	$PN_accountList.empty();
	
	RB_typeAll.Checked = true;
	
	// 전체 계좌조회 - 계좌조회 페이지로 이동
	p.ChangeTab("2511");
}

// 라디오버튼 클릭시 조회버튼 enabled
function RB_typeAll_OnClick(e){
	BT_right.setEnabled(true);
	if(gubunFlag2){
		ymd2 = currentObj.TRN_YMD;
		srn2 = currentObj.SRN;
	} else {
		ymd2 = "";
		srn2 = "";
	}
	
	if(gubunFlag1){
		BT_right.Text = "계속조회";
	} else {
		BT_right.Text = "조회";
	}
}

// 라디오버튼 클릭시 조회버튼 enabled
function RB_typeRecent_OnClick(e){
	BT_right.setEnabled(true);
	if(gubunFlag1){
		ymd1 = currentObj.TRN_YMD;
		srn1 = currentObj.SRN;
	} else {
		ymd1 = "";
		srn1 = "";
	}
	
	if(gubunFlag2){
		BT_right.Text = "계속조회";
	} else {
		BT_right.Text = "조회";
	}
}

// 조회 or 계속조회 버튼
function BT_right_OnClick(e){
	// 라디오버튼 값 체크
	if(RB_typeAll.getCheckedGroupValue() == "all"){
		retObj.INPT_DCD = "2"; // 입력구분코드 ( 전체거래내역 선택 )
	} else {
		retObj.INPT_DCD = "1"; // 입력구분코드 ( 최근거래일조회내역 선택 )
		let $PN_accountList = $("div[ui-id='PN_accountList']");
		$PN_accountList.empty();
	}
	
	retObj.CUS_ACN = currentObj.ACN;				  // 계좌번호
	
	if(currentObj.CNTI_INQ_YN == "Y"){ // 계속조회 가능한 경우
		retObj.CTNT_TRN_DCD = "1";	   			// 계속조회여부
		retObj.TRN_YMD = currentObj.TRN_YMD;	// 거래년월일
		retObj.SRN = currentObj.SRN;			// 일련번호
	} else { // 계속조회가 불가능한 경우
		// 내역 초기화 (empty)
		let $PN_accountList = $("div[ui-id='PN_accountList']");
		$PN_accountList.empty();
		
		retObj.CTNT_TRN_DCD = "0";	   			// 계속조회여부
		retObj.TRN_YMD = "        ";			// 거래년월일
		console.log(currentObj.TOB_NO);
		if(currentObj.TOB_NO){
			retObj.SRN = currentObj.TOB_NO;			// 일련번호
		} else {
			retObj.SRN = "0000000000";				// 일련번호
		}
	}
	
	// CBKEBK848010 자동화기기 거래내역 조회(ATM요청)
	p.sendRequest("searchTranList", retObj);
}

// 수신 데이터 처리
function ReceiveTran(obj){
	
	console.log(JSON.stringify(obj));
	// 값 할당
	currentObj = {
		ACN : obj.ACN.trim(),
		CNTI_INQ_YN : obj.CNTI_INQ_YN,
		TRN_YMD : obj.TRN_YMD,
		SRN : obj.SRN,
		TOB_NO : obj.TOB_NO
	}
	
	// 계좌번호	
	TB_accountNumber.setText(p.ReturnFormatAccount(currentObj.ACN));
	
	// 잔액
	LB_totalBalance.$.html('잔액 <span>' + parseInt(obj.BAL).toLocaleString() + '</span>원');	
	
	LB_totalBalance.$.css({'text-align':'right'}).find("span").css({'font-size':'32px','margin':'0 5px','font-family':'IBK iDream M'});	
		
	// 거래내역
	let rows = obj.list;
	
	if(rows.length > 0){
		PN_nullDataInfo.Visible = false;
	
		if(obj.CNTI_INQ_YN == "Y"){ // 계속조회여부
			BT_right.setText("계속조회");
			BT_right.setEnabled(true);
			if(RB_typeAll.getCheckedGroupValue() == "all"){
				gubunFlag1 = true;
				gubunFlag2 = false;
			} else {
				gubunFlag1 = false;
				gubunFlag2 = true;
			}
		} else {
			BT_right.setText("조회");
			BT_right.setEnabled(false);
			
			if(RB_typeAll.getCheckedGroupValue() == "all"){
				gubunFlag1 = false;
				gubunFlag2 = false;
			} else {
				gubunFlag1 = false;
				gubunFlag2 = false;
			}
		}
		
		MakeTranList(rows);
		
	} else {
		PN_nullDataInfo.Visible = true;
		BT_right.setText("조회");
	}
	
	SB_scrollbar1.Invalidate();
}

// 거래내역 리스트 생성
function MakeTranList(rows){
	let tag = [];
	for(let i=0; i<rows.length; i++){
		let imgIcon = "";			// 입,출금 아이콘
		let balanceTextColor = "";	// 입,출금 텍스트 색상
		
		if(rows[i].TRN_NM.trim() == "입금"){
			imgIcon = '<img src="/KRG/media/ic_deposit.png"/>';
			balanceTextColor = "#176bc8";
		} else if(rows[i].TRN_NM.trim() == "출금") {
			imgIcon = '<img src="/KRG/media/ic_withdraw.png"/>';
			balanceTextColor = "#f45408";
		} else {
			imgIcon = '';
			balanceTextColor = "#000";
		}
		
		tag.push(""
			+'<div class="list_info">'
    	    +'	<div class="text_area">'
			+'		<div class="img">' + imgIcon + '</div>'
			+'		<div>'
    	    +'  		<div class="main_text usetype" style="margin-bottom:12px;">' + rows[i].TRN_NM + '</div>'
    	    +'  		<div class="sub_text">' + p.ReturnFormatDateHyphen(rows[i].TRN_YMD) + ' | ' + rows[i].TRN_SMR + '</div>'
			+'		</div>'
    	    +'	</div>'
    	    +'  <div class="text_area_balance"><span style="color:' + balanceTextColor + '">' + parseInt(rows[i].TRN_AMT).toLocaleString() + ' </span><span class="won">원</span></div>'
    	    +'</div>'
		);
	}
	
	// 리스트를 화면에 표시
	let $PN_accountList = $("div[ui-id='PN_accountList']");
	$PN_accountList.append(""
		+'<div class="list-panel">'
		+ tag.join("")
		+'</div>'
	);

	$PN_accountList = $("div.list-panel");
	
	// 기타 리스트 css	
	$PN_accountList.find(">div.list_info").css({'justify-content':'space-between', 'padding':'0 40px'});
	$PN_accountList.find(">div.list_info").each(function(i){
		let $this = $(this);
		
		$this.find(">div.text_area").css({'display':'flex','flex-direction':'row','padding-left':'20px', 'width':'auto'});
		$this.find(">div.text_area div.sub_text").css({'font-family':'IBK iDream L'});
		$this.find(">div.text_area_balance").css({'display':'flex','flex-direction':'row','font-size':'24px', 'font-family':'IBK iDream M'});
		$this.find(">div.text_area_balance span").css({'order':'1', 'margin-right':'8px'});
		$this.find(">div.text_area_balance span.won").css({'order':'2'});
		$this.find("div.img").css({'width':'45px','display':'flex', 'align-items':'center', 'justify-content':'flex-start', 'margin-right':'20px'});
	});	
}
</script></xjscript></body>
</html>
