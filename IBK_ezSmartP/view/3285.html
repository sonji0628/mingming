<!doctype html>
<html version="1000">
<head>
	<meta charset="utf-8">
	<title>ezSmartAtm Builder Form 새문서</title>
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="[김윤섭][kkobiboy]">
	<link id="ui-style-core" rel="stylesheet" type="text/css" href="/core/app.controls.css">
	<script type="text/javascript" charset="utf-8" src="/HtaPlatform/Core/Form.JsApi"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.jquery.js"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.controls.js"></script>
	<style id="ui-style-user" type="text/css"></style>
	<script id="ui-script-user" type="text/javascript"></script>
</head>
<body oncontextmenu="return false;" class="ui-pre-load"><div class="ui-document ui-container" id="ui-document" lang="kr" ui-class="UIForm" ui-id="Form" dock="5" anchor="0b0101" ide-size="1436,1154" xonload="Form_OnLoad">
<div class="ui-control ui-panel ui-container" id="ui-171bfd1315e" style="left: 0px; top: 0px; width: 1280px; height: 1024px; right: auto; bottom: auto; z-index: 0; background-color: transparent;" ui-class="UIPanel" ui-id="PN_form" dock="0" anchor="0b0101"><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171bfd13160" style="left: 0px; top: 0px; width: auto; height: 102px; right: 0px; bottom: auto; z-index: 0; background-color: rgb(23, 107, 200);" ui-class="UIPanel" ui-id="PN_Title" dock="1" anchor="0b0101" dock-r="left:98px;top:1px;width:200px;height:76px;right:auto;bottom:auto" dock-h="102" dock-w="200"><span class="ui-control ui-label" id="ui-171bfd13161" style='left: 80px; top: 31px; width: 1120px; height: 40px; right: auto; bottom: auto; color: white; font-family: "IBK iDream M"; font-size: 38px; z-index: 0;' ui-class="UILabel" ui-id="LB_title" dock="0" anchor="0b0101"><span class="ui-content"> 선결제 신청 금액 입력</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171bfd13162" style="left: 0px; top: 102px; width: auto; height: 92px; right: 0px; bottom: auto; z-index: 1; background-color: whitesmoke;" ui-class="UIPanel" ui-id="PN_Subtitle" dock="1" anchor="0b0101" dock-r="left:0px;top:102px;width:1280px;height:92px;right:auto;bottom:auto" dock-h="92" dock-w="1280"><div class="ui-control ui-panel ui-container" id="ui-17355fb3e22" style="left: 80px; top: 12px; width: 1150px; height: 68px; right: auto; bottom: auto; z-index: 0; background-color: rgb(239, 240, 242);" ui-class="UIPanel" ui-id="PN_Subtitle_wrap" dock="0" anchor="0b0101"><span class="ui-control ui-label" id="ui-171bfd13163" style='left: 5px; top: 17px; width: 676px; height: 32px; right: auto; bottom: auto; font-family: "IBK iDream L"; font-size: 29px; z-index: 0;' ui-class="UILabel" ui-id="LB_Subtitle" dock="0" anchor="0b0101"><span class="ui-content">선결제 신청 금액을 입력해주십시오. 입력내용이 맞으면</span></span><span class="ui-control ui-label" id="ui-171a51593d6" style='border-radius: 5px; left: 687px; top: 14px; width: 76px; height: 39px; right: auto; bottom: auto; color: white; font-family: "IBK IDream M"; font-size: 26px; z-index: 1; background-color: rgb(0, 104, 196);' ui-class="UILabel" ui-id="LB_label140" dock="0" anchor="0b0101"><span class="ui-content" style="justify-content: center;">확인</span></span><span class="ui-control ui-label" id="ui-171a517878e" style='left: 768px; top: 17px; width: 208px; height: 32px; right: auto; bottom: auto; font-family: "IBK iDream L"; font-size: 28px; z-index: 2;' ui-class="UILabel" ui-id="LB_label141" dock="0" anchor="0b0101"><span class="ui-content">을 눌러주십시오.</span></span></div></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-bottom" id="ui-171bfd13164" style="left: 0px; top: auto; width: auto; height: 140px; right: 0px; bottom: 0px; z-index: 2;" ui-class="UIPanel" ui-id="PN_btn" dock="2" anchor="0b0101" dock-r="left:0px;top:884px;width:1280px;height:140px;right:auto;bottom:auto" dock-h="140" dock-w="1280"><span class="ui-control ui-button theme-orange" id="ui-171bfd13165" style='left: 36px; top: 31px; width: 258px; height: 80px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 0;' ui-class="UIButton" ui-id="BT_left" dock="0" anchor="0b0101" xonclick="BT_left_OnClick" theme="orange"><span class="ui-content">닫기</span></span><span class="ui-control ui-button theme-blue" id="ui-172729ea59d" style='left: auto; top: 31px; width: 258px; height: 80px; right: 36px; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 1;' ui-class="UIButton" ui-id="BT_right" dock="0" anchor="0b1001" xonclick="BT_right_OnClick" theme="blue"><span class="ui-content">확인</span></span><span class="ui-control ui-button theme-mint" id="ui-173b7fd6a3e" style='left: auto; top: 31px; width: 258px; height: 80px; right: 488px; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 2;' ui-class="UIButton" ui-id="BT_button_all" dock="0" anchor="0b1001" xonclick="BT_button_all_OnClick" theme="mint"><span class="ui-content">전액입력</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-fill" id="ui-17404f54e08" style="left: 0px; top: 194px; width: auto; height: auto; right: 0px; bottom: 140px; z-index: 3;" ui-class="UIPanel" ui-id="PN_contents" dock="5" anchor="0b0101" dock-r="left:105px;top:569px;width:1069px;height:265px;right:auto;bottom:auto" dock-h="265" dock-w="1069"><div class="ui-control ui-numberpad fixed" id="ui-171a5226656" style="left: 744px; top: 72px; width: 352px; height: 487px; right: auto; bottom: auto; z-index: 1;" ui-class="UINumberPad" ui-id="NP_numberpad1" dock="0" anchor="0b0101" xonkeyclick="NP_numberpad1_OnKeyClick"><table class="fixed" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td key="1"><div>1</div></td><td key="2"><div>2</div></td><td key="3"><div>3</div></td></tr><tr><td key="4"><div>4</div></td><td key="5"><div>5</div></td><td key="6"><div>6</div></td></tr><tr><td key="7"><div>7</div></td><td key="8"><div>8</div></td><td key="9"><div>9</div></td></tr><tr><td class="fix backspace" key=""><div></div></td><td key="0"><div>0</div></td><td class="fix clear" key="정정"><div>정정</div></td></tr></tbody></table><table class="shuffle" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="key-empty" key=""><div></div></td><td key="2"><div>2</div></td><td key="5"><div>5</div></td><td key="6"><div>6</div></td></tr><tr><td key="3"><div>3</div></td><td key="4"><div>4</div></td><td key="8"><div>8</div></td><td key="0"><div>0</div></td></tr><tr><td key="1"><div>1</div></td><td class="key-empty" key=""><div></div></td><td key="7"><div>7</div></td><td key="9"><div>9</div></td></tr><tr><td class="fix shuffle" colspan="2"><div>재배열</div></td><td class="fix backspace" key="backspace"><div></div></td><td class="fix clear" key="clear"><div>정정</div></td></tr></tbody></table></div><span class="ui-control ui-label" id="ui-171a5245d17" style="left: 114px; top: 123px; width: 580px; height: 32px; right: auto; bottom: auto; color: rgb(2, 111, 206); font-size: 24px; z-index: 2;" ui-class="UILabel" ui-id="LB_label_payamt" dock="0" anchor="0b0101"><span class="ui-content">결제전액금액</span></span><span class="ui-control ui-textbox" id="ui-171a52210eb" style="left: 114px; top: 170px; width: 475px; height: 80px; right: auto; bottom: auto; font-size: 30px; z-index: 0;" ui-class="UITextBox" ui-id="TB_payamt" dock="0" anchor="0b0101" xonclick="TB_payamt_OnClick"><span><input class="ui-input" type="text" maxlength="5" value=""></span></span><span class="ui-control ui-label ui-hide" id="ui-1732812996e" style="left: 114px; top: 272px; width: 475px; height: 32px; right: auto; bottom: auto; color: rgb(6, 137, 196); font-size: 22px; z-index: 3;" ui-class="UILabel" ui-id="LB_label_msg" dock="0" anchor="0b0101"><span class="ui-content">* 1만원 단위로 입력하세요.</span></span></div></div></div><xcomponent></xcomponent><xjscript><script id='xjscript' type='text/plain'>// common.js import
includeJSS("common","/KRG/0301/common.js");

var p = parent;

var numBox = TB_payamt;

// 선결제처리구분코드 셋팅
var AHST_PCSN_DCD = com.ss.getItem("3285_AHST_PCSN_DCD");  

// 신용카드입금총금액 셋팅
var CRD_MNRC_TTAL_AMT = com.ss.getItem("3285_CRD_MNRC_TTAL_AMT");  

// 최소입금원금금액 셋팅
var MNMM_MNRC_PRNC_AMT = com.ss.getItem("3285_MNMM_MNRC_PRNC_AMT");     

function Form_OnLoad(e){

   // 팝업을 호출한 opener에 팝업 window 저장 (opener에서 close 가능)
   if (host.form.opener){
	   host.form.opener.xpopup = window;
   }

   com.screen.setTimeoutEx(30000, onScreenTimeout);
   
   BT_right.Enabled = false;
   NP_numberpad1.$.find(".backspace").attr("key","backspace");
   // 텍스트박스 기본 셋팅
   TB_payamt.$.find(">span>input")
		.attr("placeholder","입력해주세요")
		.attr("readonly","true")
		.attr("disabled","true")
		.css({"padding-left":"30px","letter-spacing":"5px"});
   // 텍스트박스 테두리 셋팅
   TB_payamt.$.css({"border":"3px solid #046fd9"});		
    
   console.log( TB_payamt );
   console.log( " Form_OnLoad ::: AHST_PCSN_DCD >>>> " + AHST_PCSN_DCD );
   console.log( " Form_OnLoad ::: CRD_MNRC_TTAL_AMT >>>> " + CRD_MNRC_TTAL_AMT );
   console.log( " Form_OnLoad ::: MNMM_MNRC_PRNC_AMT >>>> " + MNMM_MNRC_PRNC_AMT );

   console.log( " Form_OnLoad ::: CRD_MNRC_TTAL_AMT.length >>>> " + String(parseInt(CRD_MNRC_TTAL_AMT)).length );
   console.log( " Form_OnLoad ::: TB_payamt.MaxLength >>>> " + TB_payamt.MaxLength );

   if(CRD_MNRC_TTAL_AMT !==  undefined && CRD_MNRC_TTAL_AMT != null) {     
     TB_payamt.MaxLength = String(parseInt(CRD_MNRC_TTAL_AMT)).length;
   }
   console.log( " Form_OnLoad ::: TB_payamt.MaxLength >>>>@@@@ " + TB_payamt.MaxLength );
   
   
   var text = "";
   if(!com.util.isNull(MNMM_MNRC_PRNC_AMT)) {      
       text = "금액 <br/>( 결제전액금액:"+com.util.fnGetFormatMoney(CRD_MNRC_TTAL_AMT)+"";
       text += ", 최소입금금액 : "+com.util.fnGetFormatMoney(MNMM_MNRC_PRNC_AMT);    
       text+=" )";
       
       $("[ui-id = 'LB_label_payamt']").css({'height':'64px','top':'108px'});
   } else {
      text = "금액 ( 결제전액금액:"+com.util.fnGetFormatMoney(CRD_MNRC_TTAL_AMT)+" )";
   }

   LB_label_payamt.Text = text;
   
   // 확인버튼 비활성화
   BT_right.Enabled = false;        
   
	//정정버튼 backspace disabled	
	com.numberpad.btnDisabled(NP_numberpad1);
}


// parent 화면의 타임아웃에 종속되어 주석처리함
function onScreenTimeout(){
	console.log("[popup] Screen Timeout!!!");
	
	com.screen.clearTimeoutEx();

	com.screen.closePopup(function(opendlg){
		opendlg.OnCloseCallback3285("timeout");
	});	
}


function NP_numberpad1_OnKeyClick(e){
    // console.log(" e.key >>>> " + e.key );
	if(e.key == "backspace"){
		e.key = '';
		numBox.Text = numBox.Text.substring ( 0, numBox.Text.length -1);
	}
	else if(e.key == "clear" || e.key == "정정"){
		e.key = '';
		numBox.Text = numBox.Text.replace(numBox.Text,"");
	} else {
	   numBox.Text += e.key;
	}

	var text = numBox.Text.replace(/\,/g, ''),
		maxLen = TB_payamt.MaxLength;

	// 글자수에 따른 버튼 Disabled 
	if (text.length == 0){
		com.numberpad.notMaxLength(NP_numberpad1);		
		com.numberpad.btnDisabled(NP_numberpad1);
	}
	else if (text.length > 0 && text.length < maxLen){
		com.numberpad.notMaxLength(NP_numberpad1);
	}	
	else if (text.length == maxLen){
	    com.numberpad.maxLength(NP_numberpad1);
	}			
	
	numBox.Text = text != "" ? com.util.Comma(parseInt(text)) : text;

	let amount = parseInt(numBox.Text.replace(/\,/g, ''));
    
	var nTotal = parseInt(CRD_MNRC_TTAL_AMT, 10),
        minAmount = parseInt(MNMM_MNRC_PRNC_AMT, 10),
        nVal = parseInt(amount, 10),
        isEnable = true;
        
    if(nTotal < nVal || nVal == 0 || isNaN(nVal) || (minAmount > nVal && MNMM_MNRC_PRNC_AMT != undefined)) {
        isEnable = false;
    }
    
    // 3-(단기카드대출) 에 해당되고 만원단위로 입력되지 않는다면,,,,
    if(AHST_PCSN_DCD == "3" && nVal % 10000 > 0 ) {
       isEnable = false;
    }
    
    // 확인버튼 활성화
    BT_right.Enabled = isEnable;

}
	
	
function TB_payamt_OnClick(e){
	numBox = this;
}

function BT_left_OnClick(e)
{
	setTimeout(function()
	{
		com.screen.closePopup(function(opendlg)
		{
	    	opendlg.OnCloseCallback3285(false);
		});
	}, 200);
}

function BT_button_all_OnClick(e){
    BT_right.Enabled = true;
    numBox.Text = com.util.Comma(parseInt(CRD_MNRC_TTAL_AMT));
    
	//정정 backspace disabled 풀기 css(초기화)
	NP_numberpad1.$.find('>table.fixed >tbody >tr >td.clear >div').css({'border':'2px solid #00437d','background-color':'#026fce'});
	NP_numberpad1.$.find('>table.fixed >tbody >tr >td.backspace >div').css({'border':'2px solid #2092bc','background-color':'#2eb6e9'});
	
	//정정 backspace 버튼 disabled 풀기(초기화)
	NP_numberpad1.$.find("tbody > tr >td.clear").css({'background-color':'Transparent'}).removeClass('ui-disabled');
	NP_numberpad1.$.find("tbody > tr >td.backspace").css({'background-color':'Transparent'}).removeClass('ui-disabled');    
    
    com.numberpad.maxLength(NP_numberpad1);
}

function BT_right_OnClick(e)
{
	let amount = parseInt(numBox.Text.replace(/\,/g, ''));	

  	// 콜백 타겟별 리턴
  	if(com.ss.getItem("3285_target") == "3193")
  	{
		setTimeout(function()
		{
			com.screen.closePopup(function(opendlg)
  			{
				opendlg.OnCloseCallback3285("3193",amount);
			});
		}, 200);
	} 
	else 
	{
		setTimeout(function()
		{
			com.screen.closePopup(function(opendlg)
  			{
  				opendlg.OnCloseCallback3285(true,amount);
  			});
		}, 200);
  	}
}
</script></xjscript></body>
</html>
