<!doctype html>
<html version="1000">
<head>
	<meta charset="utf-8">
	<title>ezSmartAtm Builder Form 새문서</title>
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="[김윤섭][kkobiboy]">
	<link id="ui-style-core" rel="stylesheet" type="text/css" href="/core/app.controls.css">
	<script type="text/javascript" charset="utf-8" src="/HtaPlatform/Core/Form.JsApi"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.jquery.js"></script>
	<script type="text/javascript" charset="utf-8" src="/core/app.controls.js"></script>
	<style id="ui-style-user" type="text/css"></style>
	<script id="ui-script-user" type="text/javascript"></script>
</head>
<body oncontextmenu="return false;" class="ui-pre-load"><div class="ui-document ui-container" id="ui-document" lang="kr" xonload="Form_OnLoad" ide-size="1389,1120" anchor="0b0101" dock="5" ui-id="Form" ui-class="UIForm">
<div class="ui-control ui-panel ui-container" id="ui-171be2e0c07" style="left: 0px; top: 0px; width: 1280px; height: 1024px; right: auto; bottom: auto; z-index: 0; background-color: transparent;" anchor="0b0101" dock="0" ui-id="PN_form" ui-class="UIPanel"><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171be2e0c08" style="left: 0px; top: 0px; width: auto; height: 102px; right: 0px; bottom: auto; z-index: 0; background-color: rgb(23, 107, 200);" anchor="0b0101" dock="1" ui-id="PN_Title" ui-class="UIPanel" dock-r="left:98px;top:1px;width:200px;height:76px;right:auto;bottom:auto" dock-h="102" dock-w="200"><span class="ui-control ui-label" id="ui-171be2e0c09" style='left: 80px; top: 31px; width: 1120px; height: 40px; right: auto; bottom: auto; color: white; font-family: "IBK iDream M"; font-size: 38px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_title" ui-class="UILabel"><span class="ui-content">선결제</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-top" id="ui-171be2e0c0a" style="left: 0px; top: 102px; width: auto; height: 92px; right: 0px; bottom: auto; z-index: 1; background-color: rgb(239, 240, 242);" anchor="0b0101" dock="1" ui-id="PN_Subtitle" ui-class="UIPanel" dock-r="left:0px;top:102px;width:1280px;height:92px;right:auto;bottom:auto" dock-h="92" dock-w="1280"><span class="ui-control ui-label" id="ui-171be2e0c0b" style='left: 82px; top: 30px; width: 235px; height: 43px; right: auto; bottom: auto; font-family: "IBK iDream L"; font-size: 32px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_Subtitle" ui-class="UILabel"><span class="ui-content">정보확인</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-bottom" id="ui-172729dbaaf" style="left: 0px; top: auto; width: auto; height: 140px; right: 0px; bottom: 0px; z-index: 2;" anchor="0b0101" dock="2" ui-id="PN_btn" ui-class="UIPanel" dock-r="left:0px;top:884px;width:1280px;height:140px;right:auto;bottom:auto" dock-h="140" dock-w="1280"><span class="ui-control ui-button theme-orange" id="ui-172729e45a9" style='left: 36px; top: 31px; width: 258px; height: 80px; right: auto; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 0;' anchor="0b0101" dock="0" ui-id="BT_left" ui-class="UIButton" theme="orange" xonclick="BT_left_OnClick"><span class="ui-content">취소</span></span><span class="ui-control ui-button theme-blue" id="ui-172729ea59d" style='left: auto; top: 31px; width: 258px; height: 80px; right: 36px; bottom: auto; font-family: "IBK iDream M"; font-size: 32px; z-index: 1;' anchor="0b1001" dock="0" ui-id="BT_right" ui-class="UIButton" theme="blue" xonclick="BT_right_OnClick"><span class="ui-content">확인</span></span></div><div class="ui-control ui-panel ui-container ui-dock ui-dock-fill" id="ui-172729f3b0f" style="left: 0px; top: 194px; width: auto; height: auto; right: 0px; bottom: 140px; z-index: 3;" anchor="0b0101" dock="5" ui-id="PN_contents" ui-class="UIPanel" dock-r="left:0px;top:194px;width:1280px;height:100px;right:auto;bottom:auto" dock-h="100" dock-w="1280"><div class="ui-control ui-panel ui-container" id="ui-172ea605b36" style="left: 83px; top: 20px; width: 1100px; height: 660px; right: auto; bottom: auto; z-index: 0;" anchor="0b0101" dock="0" ui-id="PN_wrap" ui-class="UIPanel"><div class="ui-control ui-table" id="ui-172c12f7fc6" style="border-width: 2px; border-color: rgb(194, 194, 194); left: 26px; top: 61px; width: 1050px; height: 54px; right: auto; bottom: auto; z-index: 1;" anchor="0b0101" dock="0" ui-id="TL_table_acct" ui-class="UITable"><table border="0" cellspacing="0" cellpadding="0"><thead><tr><td width="270" type="1" align-v="align-middle" align-h="align-left"></td><td type="1" align-v="align-middle" align-h="align-left"></td></tr></thead><tbody><tr height="100%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-172e441454a" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">출금계좌정보</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-172e441454b" style="padding: 0px 20px; font-size: 22px;"></div></td></tr></tbody></table></div><span class="ui-control ui-label" id="ui-172c00c6687" style='left: 26px; top: 22px; width: 441px; height: 42px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-family: "IBK IDream M"; font-size: 24px; z-index: 0;' anchor="0b0101" dock="0" ui-id="LB_label1" ui-class="UILabel"><span class="ui-content" style="align-items: flex-start;">선결제 출금계좌</span></span><span class="ui-control ui-label" id="ui-173b2a2916b" style='left: 26px; top: 304px; width: 441px; height: 42px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-family: "IBK IDream M"; font-size: 24px; z-index: 2;' anchor="0b0101" dock="0" ui-id="LB_label3" ui-class="UILabel"><span class="ui-content" style="align-items: flex-start;">결제 청구 건</span></span><div class="ui-control ui-table" id="ui-173b2a40d72" style="border-width: 2px; border-color: rgb(194, 194, 194); left: 26px; top: 199px; width: 1050px; height: 54px; right: auto; bottom: auto; z-index: 3;" anchor="0b0101" dock="0" ui-id="TL_table_payinfo" ui-class="UITable"><table border="0" cellspacing="0" cellpadding="0"><thead><tr><td width="270" type="1" align-v="align-middle" align-h="align-left"></td><td type="1" align-v="align-middle" align-h="align-left"></td></tr></thead><tbody><tr height="100%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a40d73" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">결제신청금액합계</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a40d74" style="padding: 0px 20px; font-size: 22px;"></div></td></tr></tbody></table></div><span class="ui-control ui-label" id="ui-173b2a40d9d" style='left: 26px; top: 160px; width: 441px; height: 42px; right: auto; bottom: auto; color: rgb(23, 107, 200); font-family: "IBK IDream M"; font-size: 24px; z-index: 4;' anchor="0b0101" dock="0" ui-id="LB_label4" ui-class="UILabel"><span class="ui-content" style="align-items: flex-start;">최종 신청금액</span></span><div class="ui-control ui-panel ui-container" id="ui-172ea62d2ab" style="left: 26px; top: 343px; width: 1050px; height: 360px; right: auto; bottom: auto; z-index: 5;" anchor="0b0101" dock="0" ui-id="PN_panel_pay" ui-class="UIPanel"><div class="ui-control ui-table" id="ui-173b2a811a7" style="border-width: 2px; border-color: rgb(194, 194, 194); left: 0px; top: 0px; width: 1050px; height: 360px; right: auto; bottom: auto; z-index: 0;" anchor="0b0101" dock="0" ui-id="TL_table_temp" ui-class="UITable"><table border="0" cellspacing="0" cellpadding="0"><thead><tr><td width="270" type="1" align-v="align-middle" align-h="align-left"></td><td type="1" align-v="align-middle" align-h="align-left"></td></tr></thead><tbody><tr height="17%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811a9" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">가맹점</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811aa" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"></div></td></tr><tr height="17%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811ab" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">카드번호</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811ac" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"></div></td></tr><tr height="17%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811ad" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">이용원금</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811ae" style="padding: 0px 20px; font-size: 22px; justify-content: flex-start;"></div></td></tr><tr height="17%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811af" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">당월청구금액</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811b0" style="padding: 0px 20px; font-size: 22px;"></div></td></tr><tr height="17%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811b1" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">결제대상전액</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811b2" style="padding: 0px 20px; font-size: 22px;"></div></td></tr><tr height="15%"><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811b3" style="padding: 0px 0px 0px 20px; font-size: 21px; background-color: rgb(242, 242, 242);"><span class="cell-control-label">결제신청금액</span></div></td><td><div class="ui-table-cell align-left align-middle ui-container" id="ui-173b2a811b5" style="padding: 0px 20px; font-size: 22px;"><span class="ui-control ui-textbox" id="ui-173b6c9cec6" style="left: 9px; top: 7px; width: 270px; height: 40px; right: auto; bottom: auto; z-index: 0;" anchor="0b0101" dock="0" ui-id="TB_textbox_payamt" ui-class="UITextBox"><span><input class="ui-input" type="text" maxlength="32767"></span></span><span class="ui-control ui-label" id="ui-173b6cbc88f" style="left: 288px; top: 10px; width: 360px; height: 33px; right: auto; bottom: auto; z-index: 1;" anchor="0b0101" dock="0" ui-id="LB_label_min_pay" ui-class="UILabel"><span class="ui-content">원 (최소입금금액 : 1)</span></span></div></td></tr></tbody></table></div></div></div><span class="ui-control ui-scrollbar" id="ui-172980bda14" style="left: 1220px; top: 20px; width: 32px; height: 660px; right: auto; bottom: auto; z-index: 1;" anchor="0b0101" dock="0" ui-id="SB_scrollbar_wrap" ui-class="UIScrollBar" scroll-control-id="PN_wrap"><span class="track"></span><span class="trackbutton" style="top: 0px;"></span></span></div></div></div><xcomponent></xcomponent><xjscript><script id='xjscript' type='text/plain'>// 3180.css import
importCSS("3180"     ,"3180.css");

// common.js import
importJSS("common", "common.js");

var p = parent;

function Form_OnLoad(e){

  // 임시 테이블은 히든 처리
  TL_table_temp.Visible = false;

}

function setPayAmtInfo(){
  // 출금계좌번호
  const STLM_ACN = com.acct.fnGetAccountPattern(p.G_CRDRCP301021Step3.STLM_ACN);
  TL_table_acct.DataCell(0,1,"text",STLM_ACN);

  // 선결제 신청금액
  const CRD_MNRC_TTAL_AMT = com.util.fnGetFormatMoney(com.ss.getItem("3183_CRD_MNRC_TTAL_AMT"));  
  TL_table_payinfo.DataCell(0,1,"text",CRD_MNRC_TTAL_AMT);

  fnCreatePaymentItem();
}

function fnCreatePaymentItem(){	

  console.log("html() >>>##### " +  $("[ui-id='TL_table_temp']").html() );	
  	
  let payData,records;
  
  payData = com.ss.getItem("3183_SELECT_DATA_ORIGIN");
    
  if(payData != null){
	 records = jQuery.parseJSON(payData);
  }
  
  console.log(" payData >>>##### " +  payData );	
  console.log(" records >>>##### " +  records );	
  console.log(" records.length >>>##### " +  records.length );	


  // 결제청구건 정보 가져오기
  if(records != null){
  
    let tag = [];

    for(let i = 0, Len = records.length; i < Len; i++){
	     let record = records[i],
	         MIN_AMOUNT = p.G_payInfo.AHST_PCSN_DCD === "3" ? record.MNMM_MNRC_PRNC_AMT : record.MNMM_MNRC_AMT;
	     
	     let top = 0;
	     if(i > 0){
	        top = eval(358 * i) + eval(15 * i);
	     }
	     
	     // console.log(" top >>>##### " +  top );	
	     
		 $("div[ui-id='PN_panel_pay']").append('<div class="ui-control ui-table" style="border-width: 2px; border-color: rgb(194, 194, 194); left: 0px; top: '+top+'px; width: 1050px; height: 360px; right: auto; bottom: auto; z-index: 5;" ui-id="TL_table_0'+i+'" ui-class="UITable">'
		  								    + $("[ui-id='TL_table_temp']").html()
		  								    +'</div>');
		
		 var $targetTbl = $("div[ui-id='PN_panel_pay']").find("> div[ui-id=\"TL_table_0"+i+"\"]");
		 $targetTbl.find("> table > tbody > tr:eq(0) > td:eq(1) > div.ui-table-cell" ).html('<span class="cell-control-label">'+record.AFST_NM+'</span>');
		 $targetTbl.find("> table > tbody > tr:eq(1) > td:eq(1) > div.ui-table-cell" ).html('<span class="cell-control-label">'+record.CDN+'</span>');
		 $targetTbl.find("> table > tbody > tr:eq(2) > td:eq(1) > div.ui-table-cell" ).html('<span class="cell-control-label">'+com.util.fnGetFormatMoney(record.CRD_OTST_PRNC_AMT)+'</span>');
		 $targetTbl.find("> table > tbody > tr:eq(3) > td:eq(1) > div.ui-table-cell" ).html('<span class="cell-control-label">'+com.util.fnGetFormatMoney(record.CRD_TMNB_AMT)+'</span>');
		 $targetTbl.find("> table > tbody > tr:eq(4) > td:eq(1) > div.ui-table-cell" ).html('<span class="cell-control-label">'+com.util.fnGetFormatMoney(record.OTST_TTAL_AMT)+'</span>');
		 $targetTbl.find("> table > tbody > tr:eq(5) > td:eq(1) > div.ui-table-cell > span[ui-id='TB_textbox_payamt'] > span > input[type=text]")
		  																			.attr("index",i)
		  																			.attr("readonly","true")
		 																		    .val(com.util.fnGetFormatMoney(record.OTST_TTAL_AMT));		 
		 $targetTbl.find("> table > tbody > tr:eq(5) > td:eq(1) > div.ui-table-cell > span[ui-id='LB_label_min_pay'] > span").html("원 (최소입금금액 : "+com.util.fnGetFormatMoney(MIN_AMOUNT)+")");		 
		 				
		 // 입력박스 click 이벤트 삭제					   
         $targetTbl.find("> table > tbody > tr:eq(5) > td:eq(1) > div.ui-table-cell > span[ui-id='TB_textbox_payamt'] > span > input[type=text]")
         					.off("click");
         // 입력박스 click 이벤트 생성
		 $targetTbl.find("> table > tbody > tr:eq(5) > td:eq(1) > div.ui-table-cell > span[ui-id='TB_textbox_payamt'] > span > input[type=text]")
		 					.on("click",function(e){
		 					    var $obj = $(this),
		 					    	index = $obj.attr("index");
								
							    // 결제내역 인덱스 셋팅
							    com.ss.setItem("3285_payinfo_idx",index);
							
							    // 선결제 - 금액 입력 팝업 조회
							    p.sendRequest("m2_pop_payAmtKeypad");
		 				    });	    		 				
		 
    }  // end for - records

    const panel_pay_height = eval(358 * records.length) + eval(15 * records.length);		
    $("div[ui-id='PN_panel_pay']").css({"height":panel_pay_height});
    
//    console.log("panel_pay_height >>>>>> " +  panel_pay_height );
//    console.log("PN_panel_pay.html >>>>>> " +  $("div[ui-id='PN_panel_pay']").html() );
	  	  
  }  // end if - records      	
  	
}

function BT_left_OnClick(e){
	SCREEN.WriteJnl("[선결제 정보확인] 취소");
   	ATMCOMM.BusinessEnd(ATMCOMM.RET_CAN);
}

function BT_right_OnClick(e){

	var payGridData   = com.ss.getItem("3183_Grid1");
  
   	let jsonGrid;
	  
   	if(payGridData != null){
   		jsonGrid = jQuery.parseJSON(payGridData);
   	}
	
  	for(let i = 0, Len = jsonGrid.length; i < Len; i++){
  		let record = jsonGrid[i];
		  
	 	// tempGrid 리스트 재적재
	  	if(record.TEMP_MNRC_RQST_AMT != undefined){
	    	record.MNRC_RQST_AMT =  record.TEMP_MNRC_RQST_AMT;
	    	delete record.TEMP_MNRC_RQST_AMT;
	  	}	
   	}  // end for - records	
   
   	console.log("JSON.stringify(jsonGrid)  >>>>>> " +  JSON.stringify(jsonGrid) );

  	// 선결제 - 신용카드입금총금액 재셋팅
  	com.ss.setItem("3183_CRD_MNRC_TTAL_AMT",com.ss.getItem("3285_TEMP_TOTAL"));

  	// 결제 청구 데이터 재셋팅
  	com.ss.setItem("3183_Grid1",JSON.stringify(jsonGrid));

	SCREEN.WriteJnl("[선결제 정보확인] 정상");
  	// 선결제 - 할부 건별(금액별) 신청 안내 화면 조회02
  	p.sendRequest("step4_2_pay_guide");       
      
}
</script></xjscript></body>
</html>
